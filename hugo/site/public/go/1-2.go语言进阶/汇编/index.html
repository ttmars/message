<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.96.0" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>汇编 &middot; Blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="/public/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="/public/css/poole.css">
  <link type="text/css" rel="stylesheet" href="/public/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/public/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="/public/css/bootstrap-iso.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body style="background-color: #e8e8e8;">
	<div class="bootstrap-iso">
		<div class="container-fluid">
			<div class="row">
				
				<div class="col-md-2">
					
				</div>
				
				<div class="col-md-8">
					<nav class="navbar navbar-default  nav-stacked" role="navigation">
					    <div class="container-fluid">
							<div class="navbar-header">
								<button type="button" class="navbar-toggle" data-toggle="collapse"
										data-target="#example-navbar-collapse">
									<span class="sr-only">切换导航</span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a class="navbar-brand" href="/">Home</a>
							</div>
							<div class="collapse navbar-collapse" id="example-navbar-collapse">
								<ul class="nav navbar-nav">
									<li id="hot"><a href="/hot">资讯</a></li>
									<li id="tool"><a href="/tool">导航</a></li>
									<li id="public"><a href="/public">随笔</a></li>
									<li><a href="#">关于</a></li>
								</ul>
								<i class="navbar-text navbar-right" style="color: #AC2925;"><b>The winner takes it all.</b></i>
							</div>
							
					    </div>
					</nav>
				</div>
				
				<div class="col-md-2">
					
				</div>
				
			</div>
		</div>
	</div>
	
	<div class="theme-base-08 ">
		
		<main class="content container">
		<div class="post">
  <h1>汇编</h1>
  <time datetime=2022-05-06T10:26:00&#43;0800 class="post-date">Fri, May 6, 2022</time>
  <h3 id="寄存器">寄存器</h3>
<h4 id="通用寄存器">通用寄存器</h4>
<ul>
<li>FLAGS（状态寄存器）：CMP、TEST指令会修改FLAGS寄存器，实现流程控制</li>
<li>IP（指令寄存器）：保存下一条将要被执行的指令地址，不能直接引用；由JMP、CALL、RET等指令间接修改</li>
<li>AX、BX、CX、DX（通用寄存器）</li>
<li>ESI、EDI（通用寄存器）：扩展源索引寄存器、扩展目标索引寄存器</li>
<li>BP（通用寄存器）：记录当前函数帧的开始位置，用来引用栈上的函数参数和局部变量</li>
<li>SP（通用寄存器）：记录当前栈指针的位置，用于寻址栈上的数据</li>
<li>R8~R15（通用寄存器）</li>
</ul>
<h4 id="伪寄存器">伪寄存器</h4>
<ul>
<li>伪PC：IP寄存器的别名</li>
<li>伪FP（frame pointer）：1.栈帧寄存器，执行当前函数调用栈帧的栈底；2.对应函数的帧指针，用于访问函数的参数和返回值</li>
<li>伪SP（stack pointer）：指向当前函数栈帧的底部（高地址），用于定位局部变量；真SP，指向当前函数栈帧的顶部（低地址），用于定位参数和返回值</li>
<li>伪SB（static base pointer）：静态基址寄存器，它和全局符号一起表示全局变量的地址</li>
</ul>
<h4 id="辨别真伪sp寄存器">辨别真伪SP寄存器：</h4>
<ul>
<li>没有标识符前缀的表示真SP寄存器：(SP)、+8(SP)</li>
<li>有标识符前缀的表示伪SP寄存器：a(SP)、b+8(SP)</li>
</ul>
<h4 id="区别fp真sp伪sp作用">区别FP、真SP、伪SP作用</h4>
<ul>
<li>伪FP：定位参数和返回值</li>
<li>伪SP：定位局部变量</li>
<li>真SP：定位调用其他函数的参数和返回值</li>
</ul>
<h3 id="x86-64指令集">X86-64指令集</h3>
<ul>
<li>数据传输指令：MOVB、MOVW、MOVL、MOVQ</li>
<li>算数指令：ADD、SUB、MUL、DIV、AND、OR、NOT</li>
<li>流程控制指令：CMP、JMP、JMP-if-x、CALL、RET</li>
<li>取地址、压栈、出栈：LEA、PUSH、POP</li>
</ul>
<h3 id="函数栈帧布局">函数栈帧布局</h3>
<p>&hellip;
args to callee（当前函数的参数和返回值，由调用者分配空间）
return address
BP指针
locals
args to callee（调用下个函数时，分配的参数、返回值空间）
&hellip;</p>
<h3 id="操作数宽度">操作数宽度</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">B</span>:<span style="color:#a6e22e">表示BYTE</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">字节</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">8</span><span style="color:#a6e22e">位</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">W</span>:<span style="color:#a6e22e">表示WORD</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">字</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">16</span><span style="color:#a6e22e">位</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">L</span>:<span style="color:#a6e22e">表示LONG</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">长字</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">32</span><span style="color:#a6e22e">位</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Q</span>:<span style="color:#a6e22e">表示QuadWord</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#a6e22e">四字</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">64</span><span style="color:#a6e22e">位</span>
</span></span></code></pre></div><h3 id="输出汇编">输出汇编</h3>
<h4 id="正向生成汇编">正向生成汇编</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">tool</span> <span style="color:#a6e22e">compile</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">l</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">N</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">S</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">gcflags</span>=<span style="color:#e6db74">&#34;-S -N -l&#34;</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
</span></span></code></pre></div><h4 id="反汇编">反汇编</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@iZ8vb8qjajxkxytobaq81hZ go<span style="color:#f92672">]</span><span style="color:#75715e"># go tool objdump</span>
</span></span><span style="display:flex;"><span>usage: go tool objdump <span style="color:#f92672">[</span>-S<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-gnu<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>-s symregexp<span style="color:#f92672">]</span> binary <span style="color:#f92672">[</span>start end<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  -S	print Go code alongside assembly
</span></span><span style="display:flex;"><span>  -gnu
</span></span><span style="display:flex;"><span>    	print GNU assembly next to Go assembly <span style="color:#f92672">(</span>where supported<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  -s string
</span></span><span style="display:flex;"><span>    	only dump symbols matching this regexp
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>go tool objdump -S -gnu -s main.main main.exe
</span></span></code></pre></div><h4 id="区别">区别</h4>
<ul>
<li>正向汇编代码存在伪寄存器</li>
<li>正向汇编立即数为10进制，反汇编代码为16进制</li>
<li>反汇编代码能更真实地表达程序的运行过程</li>
</ul>
<h3 id="实例">实例</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">add</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>	println(<span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//go:noinline
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span>  {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">a</span><span style="color:#f92672">+</span><span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>汇编：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ go tool compile -N -l -S main.go
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;</span>.main STEXT size<span style="color:#f92672">=</span><span style="color:#ae81ff">86</span> args<span style="color:#f92672">=</span>0x0 locals<span style="color:#f92672">=</span>0x20 funcid<span style="color:#f92672">=</span>0x0 align<span style="color:#f92672">=</span>0x0
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00000</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        TEXT    <span style="color:#e6db74">&#34;&#34;</span>.main<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>, ABIInternal, $32-0
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00000</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        CMPQ    SP, 16<span style="color:#f92672">(</span>R14<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0004 <span style="color:#ae81ff">00004</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        PCDATA  $0, $-<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        0x0004 <span style="color:#ae81ff">00004</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        JLS     <span style="color:#ae81ff">79</span>
</span></span><span style="display:flex;"><span>        0x0006 <span style="color:#ae81ff">00006</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        PCDATA  $0, $-<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        0x0006 <span style="color:#ae81ff">00006</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        SUBQ    $32, SP
</span></span><span style="display:flex;"><span>        0x000a <span style="color:#ae81ff">00010</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        MOVQ    BP, 24<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x000f <span style="color:#ae81ff">00015</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        LEAQ    24<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>        0x0014 <span style="color:#ae81ff">00020</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        FUNCDATA        $0, gclocals·33cdeccccebe80329f1fdbee7f5874cb<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0014 <span style="color:#ae81ff">00020</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        FUNCDATA        $1, gclocals·33cdeccccebe80329f1fdbee7f5874cb<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0014 <span style="color:#ae81ff">00020</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        MOVL    $10, AX
</span></span><span style="display:flex;"><span>        0x0019 <span style="color:#ae81ff">00025</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        MOVL    $20, BX
</span></span><span style="display:flex;"><span>        0x001e <span style="color:#ae81ff">00030</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        PCDATA  $1, $0
</span></span><span style="display:flex;"><span>        0x001e <span style="color:#ae81ff">00030</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        NOP
</span></span><span style="display:flex;"><span>        0x0020 <span style="color:#ae81ff">00032</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        CALL    <span style="color:#e6db74">&#34;&#34;</span>.add<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0025 <span style="color:#ae81ff">00037</span> <span style="color:#f92672">(</span>main.go:4<span style="color:#f92672">)</span>        MOVQ    AX, <span style="color:#e6db74">&#34;&#34;</span>.c+16<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x002a <span style="color:#ae81ff">00042</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        CALL    runtime.printlock<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x002f <span style="color:#ae81ff">00047</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        MOVQ    <span style="color:#e6db74">&#34;&#34;</span>.c+16<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, AX
</span></span><span style="display:flex;"><span>        0x0034 <span style="color:#ae81ff">00052</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        CALL    runtime.printint<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0039 <span style="color:#ae81ff">00057</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        CALL    runtime.printnl<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x003e <span style="color:#ae81ff">00062</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        NOP
</span></span><span style="display:flex;"><span>        0x0040 <span style="color:#ae81ff">00064</span> <span style="color:#f92672">(</span>main.go:5<span style="color:#f92672">)</span>        CALL    runtime.printunlock<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0045 <span style="color:#ae81ff">00069</span> <span style="color:#f92672">(</span>main.go:6<span style="color:#f92672">)</span>        MOVQ    24<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>        0x004a <span style="color:#ae81ff">00074</span> <span style="color:#f92672">(</span>main.go:6<span style="color:#f92672">)</span>        ADDQ    $32, SP
</span></span><span style="display:flex;"><span>        0x004e <span style="color:#ae81ff">00078</span> <span style="color:#f92672">(</span>main.go:6<span style="color:#f92672">)</span>        RET
</span></span><span style="display:flex;"><span>        0x004f <span style="color:#ae81ff">00079</span> <span style="color:#f92672">(</span>main.go:6<span style="color:#f92672">)</span>        NOP
</span></span><span style="display:flex;"><span>        0x004f <span style="color:#ae81ff">00079</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        PCDATA  $1, $-<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        0x004f <span style="color:#ae81ff">00079</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        PCDATA  $0, $-<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        0x004f <span style="color:#ae81ff">00079</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        CALL    runtime.morestack_noctxt<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0054 <span style="color:#ae81ff">00084</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        PCDATA  $0, $-<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        0x0054 <span style="color:#ae81ff">00084</span> <span style="color:#f92672">(</span>main.go:3<span style="color:#f92672">)</span>        JMP     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">49</span> 3b <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">76</span> <span style="color:#ae81ff">49</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">48</span>  I;f.vIH.. H.l$.H
</span></span><span style="display:flex;"><span>        0x0010 8d 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">18</span> b8 0a <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> bb <span style="color:#ae81ff">14</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">90</span>  .l$...........f.
</span></span><span style="display:flex;"><span>        0x0020 e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">10</span> e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">48</span>  .....H.D$......H
</span></span><span style="display:flex;"><span>        0x0030 8b <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">10</span> e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">66</span> <span style="color:#ae81ff">90</span>  .D$...........f.
</span></span><span style="display:flex;"><span>        0x0040 e8 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">48</span> 8b 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">20</span> c3 e8  .....H.l$.H.. ..
</span></span><span style="display:flex;"><span>        0x0050 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> eb aa                                ......
</span></span><span style="display:flex;"><span>        rel 33+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> <span style="color:#e6db74">&#34;&#34;</span>.add+0
</span></span><span style="display:flex;"><span>        rel 43+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> runtime.printlock+0
</span></span><span style="display:flex;"><span>        rel 53+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> runtime.printint+0
</span></span><span style="display:flex;"><span>        rel 58+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> runtime.printnl+0
</span></span><span style="display:flex;"><span>        rel 65+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> runtime.printunlock+0
</span></span><span style="display:flex;"><span>        rel 80+4 t<span style="color:#f92672">=</span><span style="color:#ae81ff">7</span> runtime.morestack_noctxt+0
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;</span>.add STEXT nosplit size<span style="color:#f92672">=</span><span style="color:#ae81ff">56</span> args<span style="color:#f92672">=</span>0x10 locals<span style="color:#f92672">=</span>0x10 funcid<span style="color:#f92672">=</span>0x0 align<span style="color:#f92672">=</span>0x0
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00000</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        TEXT    <span style="color:#e6db74">&#34;&#34;</span>.add<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>, NOSPLIT|ABIInternal, $16-16
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00000</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        SUBQ    $16, SP
</span></span><span style="display:flex;"><span>        0x0004 <span style="color:#ae81ff">00004</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        MOVQ    BP, 8<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0009 <span style="color:#ae81ff">00009</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        LEAQ    8<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>        0x000e <span style="color:#ae81ff">00014</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        FUNCDATA        $0, gclocals·33cdeccccebe80329f1fdbee7f5874cb<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x000e <span style="color:#ae81ff">00014</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        FUNCDATA        $1, gclocals·33cdeccccebe80329f1fdbee7f5874cb<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x000e <span style="color:#ae81ff">00014</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        FUNCDATA        $5, <span style="color:#e6db74">&#34;&#34;</span>.add.arginfo1<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x000e <span style="color:#ae81ff">00014</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        MOVQ    AX, <span style="color:#e6db74">&#34;&#34;</span>.a+24<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0013 <span style="color:#ae81ff">00019</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        MOVQ    BX, <span style="color:#e6db74">&#34;&#34;</span>.b+32<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0018 <span style="color:#ae81ff">00024</span> <span style="color:#f92672">(</span>main.go:9<span style="color:#f92672">)</span>        MOVQ    $0, <span style="color:#e6db74">&#34;&#34;</span>.~r0<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x0020 <span style="color:#ae81ff">00032</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       MOVQ    <span style="color:#e6db74">&#34;&#34;</span>.a+24<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, AX
</span></span><span style="display:flex;"><span>        0x0025 <span style="color:#ae81ff">00037</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       ADDQ    <span style="color:#e6db74">&#34;&#34;</span>.b+32<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, AX
</span></span><span style="display:flex;"><span>        0x002a <span style="color:#ae81ff">00042</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       MOVQ    AX, <span style="color:#e6db74">&#34;&#34;</span>.~r0<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        0x002e <span style="color:#ae81ff">00046</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       MOVQ    8<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>        0x0033 <span style="color:#ae81ff">00051</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       ADDQ    $16, SP
</span></span><span style="display:flex;"><span>        0x0037 <span style="color:#ae81ff">00055</span> <span style="color:#f92672">(</span>main.go:10<span style="color:#f92672">)</span>       RET
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> ec <span style="color:#ae81ff">10</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">48</span> 8d 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span>  H...H.l$.H.l$.H.
</span></span><span style="display:flex;"><span>        0x0010 <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> 5c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">48</span> c7 <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>  D$.H.<span style="color:#ae81ff">\$</span> H..$....
</span></span><span style="display:flex;"><span>        0x0020 <span style="color:#ae81ff">48</span> 8b <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">18</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">03</span> <span style="color:#ae81ff">44</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">89</span> <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">48</span> 8b  H.D$.H.D$ H..$H.
</span></span><span style="display:flex;"><span>        0x0030 6c <span style="color:#ae81ff">24</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">48</span> <span style="color:#ae81ff">83</span> c4 <span style="color:#ae81ff">10</span> c3                          l$.H....
</span></span><span style="display:flex;"><span>go.cuinfo.packagename. SDWARFCUINFO dupok size<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        0x0000 6d <span style="color:#ae81ff">61</span> <span style="color:#ae81ff">69</span> 6e                                      main
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;</span>..inittask SNOPTRDATA size<span style="color:#f92672">=</span><span style="color:#ae81ff">24</span>
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>  ................
</span></span><span style="display:flex;"><span>        0x0010 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>                          ........
</span></span><span style="display:flex;"><span>gclocals·33cdeccccebe80329f1fdbee7f5874cb SRODATA dupok size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">01</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">00</span>                          ........
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;</span>.add.arginfo1 SRODATA static dupok size<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>        0x0000 <span style="color:#ae81ff">00</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">08</span> <span style="color:#ae81ff">08</span> ff                                   .....
</span></span></code></pre></div><p>反汇编：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Ares@LAPTOP-6CNM9LS0 MINGW64 /d/project/goProject/Demo
</span></span><span style="display:flex;"><span>$ go build main.go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Ares@LAPTOP-6CNM9LS0 MINGW64 /d/project/goProject/Demo
</span></span><span style="display:flex;"><span>$ go tool objdump -S main.exe
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TEXT main.main<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span> D:/project/goProject/Demo/main.go
</span></span><span style="display:flex;"><span>func main<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>  0x459ec0              493b6610                CMPQ 0x10<span style="color:#f92672">(</span>R14<span style="color:#f92672">)</span>, SP
</span></span><span style="display:flex;"><span>  0x459ec4              <span style="color:#ae81ff">7649</span>                    JBE 0x459f0f
</span></span><span style="display:flex;"><span>  0x459ec6              4883ec20                SUBQ $0x20, SP
</span></span><span style="display:flex;"><span>  0x459eca              48896c2418              MOVQ BP, 0x18<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459ecf              488d6c2418              LEAQ 0x18<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>        c :<span style="color:#f92672">=</span> add<span style="color:#f92672">(</span>10,20<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459ed4              b80a000000              MOVL $0xa, AX
</span></span><span style="display:flex;"><span>  0x459ed9              bb14000000              MOVL $0x14, BX
</span></span><span style="display:flex;"><span>  0x459ede              <span style="color:#ae81ff">6690</span>                    NOPW
</span></span><span style="display:flex;"><span>  0x459ee0              e83b000000              CALL main.add<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459ee5              <span style="color:#ae81ff">4889442410</span>              MOVQ AX, 0x10<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>        println<span style="color:#f92672">(</span>c<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459eea              e8d162fdff              CALL runtime.printlock<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459eef              488b442410              MOVQ 0x10<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, AX
</span></span><span style="display:flex;"><span>  0x459ef4              e8c769fdff              CALL runtime.printint<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459ef9              e82265fdff              CALL runtime.printnl<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459efe              <span style="color:#ae81ff">6690</span>                    NOPW
</span></span><span style="display:flex;"><span>  0x459f00              e83b63fdff              CALL runtime.printunlock<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>  0x459f05              488b6c2418              MOVQ 0x18<span style="color:#f92672">(</span>SP<span style="color:#f92672">)</span>, BP
</span></span><span style="display:flex;"><span>  0x459f0a              4883c420                ADDQ $0x20, SP
</span></span><span style="display:flex;"><span>  0x459f0e              c3                      RET
</span></span><span style="display:flex;"><span>func main<span style="color:#f92672">(){</span>
</span></span><span style="display:flex;"><span>  0x459f0f              e82c87ffff              CALL runtime.morestack_noctxt.abi0<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0x459f14              ebaa                    JMP main.main<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TEXT main.add<span style="color:#f92672">(</span>SB<span style="color:#f92672">)</span> D:/project/goProject/Demo/main.go
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> a+b
</span></span><span style="display:flex;"><span>  0x459f20              4801d8                  ADDQ BX, AX
</span></span><span style="display:flex;"><span>  0x459f23              c3                      RET
</span></span></code></pre></div><h3 id="汇编查看工具">汇编查看工具</h3>
<p><a href="https://github.com/loov/lensm">https://github.com/loov/lensm</a></p>
<p><a href="https://www.storj.io/blog/lensm">https://www.storj.io/blog/lensm</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 通过注释关闭函数内联优化//go:noinline
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 安装
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">go</span> <span style="color:#a6e22e">install</span> <span style="color:#a6e22e">loov</span>.<span style="color:#a6e22e">dev</span><span style="color:#f92672">/</span><span style="color:#a6e22e">lensm</span><span style="color:#960050;background-color:#1e0010">@</span><span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 使用
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">lensm</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">watch</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">filter</span> <span style="color:#a6e22e">main</span>.<span style="color:#a6e22e">main</span> <span style="color:#a6e22e">xx</span>.<span style="color:#a6e22e">exe</span>
</span></span></code></pre></div><h3 id="关于函数内联优化">关于函数内联优化</h3>
<p><a href="https://mp.weixin.qq.com/s/WfjnwzZvBsymk_DyhAV_6g">https://mp.weixin.qq.com/s/WfjnwzZvBsymk_DyhAV_6g</a></p>

</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "spf13" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</main>
		
		
		  
		
	</div>
	
  </body>
</html>
