<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.106.0">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>3.数组和切片 &middot; Blog</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="/public/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="/public/css/poole.css">
  <link type="text/css" rel="stylesheet" href="/public/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="/public/css/hyde.css">
  <link type="text/css" rel="stylesheet" href="/public/css/bootstrap-iso.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body style="background-color: #e8e8e8;">
	<div class="bootstrap-iso">
		<div class="container-fluid">
			<div class="row">
				
				<div class="col-md-2">
					
				</div>
				
				<div class="col-md-8">
					<nav class="navbar navbar-default  nav-stacked" role="navigation">
					    <div class="container-fluid">
							<div class="navbar-header">
								<button type="button" class="navbar-toggle" data-toggle="collapse"
										data-target="#example-navbar-collapse">
									<span class="sr-only">切换导航</span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
									<span class="icon-bar"></span>
								</button>
								<a class="navbar-brand" href="/">Home</a>
							</div>
							<div class="collapse navbar-collapse" id="example-navbar-collapse">
								<ul class="nav navbar-nav">
									<li id="hot"><a href="/hot">资讯</a></li>
									<li id="tool"><a href="/tool">导航</a></li>
									<li id="public"><a href="/public">随笔</a></li>
									<li><a href="#">关于</a></li>
								</ul>
								<i class="navbar-text navbar-right" style="color: #AC2925;"><b>To making it count.</b></i>
							</div>
							
					    </div>
					</nav>
				</div>
				
				<div class="col-md-2">
					
				</div>
				
			</div>
		</div>
	</div>
	
	<div class="theme-base-08 ">
		
		<main class="content container">
		<div class="post">
  <h1>3.数组和切片</h1>
  <time datetime=2022-05-06T10:26:00&#43;0800 class="post-date">Fri, May 6, 2022</time>
  <h3 id="数组">数组</h3>
<h4 id="初始化">初始化</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">arr1</span> <span style="color:#f92672">:=</span> [<span style="color:#ae81ff">3</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">arr2</span> <span style="color:#f92672">:=</span> [<span style="color:#f92672">...</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span></code></pre></div><h4 id="数组比较">数组比较</h4>
<p>对于两个数组，只有元素的类型和长度都相等时，才是同一类型</p>
<p>在编译时创建数组类型</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/compile/internal/types/type.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewArray</span>(<span style="color:#a6e22e">elem</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">bound</span> <span style="color:#66d9ef">int64</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span> {}
</span></span></code></pre></div><h4 id="内存模型">内存模型</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>()  {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">//arr := [5]bool{true, true, true, true, true}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">arr</span> <span style="color:#f92672">:=</span> [<span style="color:#ae81ff">5</span>]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">55</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;首地址=%p 值=%v 长度=%v 容量=%v 大小=%v\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>, <span style="color:#a6e22e">arr</span>, len(<span style="color:#a6e22e">arr</span>), cap(<span style="color:#a6e22e">arr</span>), <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">arr</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:=</span><span style="color:#ae81ff">0</span>;<span style="color:#a6e22e">i</span>&lt;len(<span style="color:#a6e22e">arr</span>);<span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;地址=%p 索引=%d 值=%v\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">arr</span>[<span style="color:#a6e22e">i</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//首地址=0xc00000c360 值=[11 22 33 44 55] 长度=5 容量=5 大小=40
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//地址=0xc00000c360 索引=0 值=11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//地址=0xc00000c368 索引=1 值=22
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//地址=0xc00000c370 索引=2 值=33
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//地址=0xc00000c378 索引=3 值=44
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//地址=0xc00000c380 索引=4 值=55
</span></span></span></code></pre></div><h3 id="切片">切片</h3>
<h4 id="初始化-1">初始化</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">s1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">array</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">slice</span>[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s3</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s4</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">3</span>)
</span></span></code></pre></div><h4 id="运行时表示">运行时表示</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// src/runtime/slice.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">slice</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">array</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">len</span>   <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">cap</span>   <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// src/reflect/value.go
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SliceHeader</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Data</span> <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Len</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Cap</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="内存模型-1">内存模型</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;reflect&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>()  {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">10</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">22</span>, <span style="color:#ae81ff">33</span>, <span style="color:#ae81ff">44</span>, <span style="color:#ae81ff">55</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sli:地址=%p 值=%v 类型=%T 长度=%v 容量=%v 大小=%v\n\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sli</span>, <span style="color:#a6e22e">sli</span>, <span style="color:#a6e22e">sli</span>, len(<span style="color:#a6e22e">sli</span>), cap(<span style="color:#a6e22e">sli</span>), <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">sli</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceHeader</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sli</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sli.Data:地址=%p 值=%v 类型=%T 大小=%v\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Data</span>), <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Data</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sli.Len:地址=%p 值=%v 类型=%T 大小=%v\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Len</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Len</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Len</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Len</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sli.Cap:地址=%p 值=%v 类型=%T 大小=%v\n\n&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Cap</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Cap</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Cap</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Cap</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:=</span><span style="color:#ae81ff">0</span>;<span style="color:#a6e22e">i</span>&lt;len(<span style="color:#a6e22e">sli</span>);<span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;sli[%d]地址=%p 值=%v\n&#34;</span>, <span style="color:#a6e22e">i</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sli</span>[<span style="color:#a6e22e">i</span>], <span style="color:#a6e22e">sli</span>[<span style="color:#a6e22e">i</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//sli:地址=0xc000004078 值=[11 22 33 44 55] 类型=[]int 长度=5 容量=10 大小=24
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli.Data:地址=0xc000004078 值=0xc0000161e0 类型=uintptr 大小=8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli.Len:地址=0xc000004080 值=5 类型=int 大小=8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli.Cap:地址=0xc000004088 值=10 类型=int 大小=8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli[0]地址=0xc0000161e0 值=11
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli[1]地址=0xc0000161e8 值=22
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli[2]地址=0xc0000161f0 值=33
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli[3]地址=0xc0000161f8 值=44
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//sli[4]地址=0xc000016200 值=55
</span></span></span></code></pre></div><h4 id="长度和容量">长度和容量</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">9</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">s1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sli</span>[<span style="color:#a6e22e">i</span>:<span style="color:#a6e22e">j</span>]		<span style="color:#75715e">// len=j-i cap:9(源切片容量)-i
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sli</span>[<span style="color:#a6e22e">i</span>:<span style="color:#a6e22e">j</span>:<span style="color:#a6e22e">k</span>]	<span style="color:#75715e">// len=j-i cap=k-i
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>()  {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">5</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span>:<span style="color:#ae81ff">5</span>:<span style="color:#ae81ff">7</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">sli</span>, len(<span style="color:#a6e22e">sli</span>), cap(<span style="color:#a6e22e">sli</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s1</span>, len(<span style="color:#a6e22e">s1</span>), cap(<span style="color:#a6e22e">s1</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s2</span>, len(<span style="color:#a6e22e">s2</span>), cap(<span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//[1 2 3 4 5 6 7 8 9] 9 9
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//[3 4 5] 3 7
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//[3 4 5] 3 5
</span></span></span></code></pre></div><h4 id="nil切片和空切片的区别">nil切片和空切片的区别</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;reflect&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>()  {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// nil切片，不分配底层数组指针，sli==nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s1</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v1</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceHeader</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s1</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">Data</span>), <span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">Len</span>, <span style="color:#a6e22e">v1</span>.<span style="color:#a6e22e">Cap</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// 空切片，分配底层数组指针，sli!=nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> make([]<span style="color:#66d9ef">int</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">v2</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceHeader</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">Data</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">Data</span>), <span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">Len</span>, <span style="color:#a6e22e">v2</span>.<span style="color:#a6e22e">Cap</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//0 &lt;nil&gt; 0 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//10089560 0x99f458 0 0
</span></span></span></code></pre></div><h4 id="切片作为参数">切片作为参数</h4>
<p>由于切片是引用类型，将切片作为参数传递可能会影响原切片，具体情况具体分析。若要不影响原切片，使用copy函数</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 切片长度等于容量，append操作会导致底层数组扩容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// 由于s[0]是在扩容之前修改的，两个切片共享底层数组，故源切片会更新
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f1</span>(<span style="color:#a6e22e">s</span> []<span style="color:#66d9ef">int</span>)  {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> = append(<span style="color:#a6e22e">s</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 由于s[0]是在扩容之后修改的，两个切片分别指向不同的底层数组，故源切片不受影响
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f2</span>(<span style="color:#a6e22e">s</span> []<span style="color:#66d9ef">int</span>)  {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> = append(<span style="color:#a6e22e">s</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 直接传递切片指针，此时两个切片指向同一个运行时结构体，所有字段（底层数组指针、长度、容量）都受影响，与顺序无关
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f3</span>(<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span>[]<span style="color:#66d9ef">int</span>)  {
</span></span><span style="display:flex;"><span>	(<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span>)[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span> = append(<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f4</span>(<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span>[]<span style="color:#66d9ef">int</span>)  {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span> = append(<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span>, <span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>	(<span style="color:#f92672">*</span><span style="color:#a6e22e">s</span>)[<span style="color:#ae81ff">0</span>] = <span style="color:#ae81ff">88</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s1</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s1:%v len:%v cap:%v\n&#34;</span>, <span style="color:#a6e22e">s1</span>, len(<span style="color:#a6e22e">s1</span>), cap(<span style="color:#a6e22e">s1</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f1</span>(<span style="color:#a6e22e">s1</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s1:%v len:%v cap:%v\n\n&#34;</span>, <span style="color:#a6e22e">s1</span>, len(<span style="color:#a6e22e">s1</span>), cap(<span style="color:#a6e22e">s1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s2</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s2:%v len:%v cap:%v\n&#34;</span>, <span style="color:#a6e22e">s2</span>, len(<span style="color:#a6e22e">s2</span>), cap(<span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f2</span>(<span style="color:#a6e22e">s2</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s2:%v len:%v cap:%v\n\n&#34;</span>, <span style="color:#a6e22e">s2</span>, len(<span style="color:#a6e22e">s2</span>), cap(<span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s3</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s3:%v len:%v cap:%v\n&#34;</span>, <span style="color:#a6e22e">s3</span>, len(<span style="color:#a6e22e">s3</span>), cap(<span style="color:#a6e22e">s3</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f3</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s3</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s3:%v len:%v cap:%v\n\n&#34;</span>, <span style="color:#a6e22e">s3</span>, len(<span style="color:#a6e22e">s3</span>), cap(<span style="color:#a6e22e">s3</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s4</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s4:%v len:%v cap:%v\n&#34;</span>, <span style="color:#a6e22e">s4</span>, len(<span style="color:#a6e22e">s4</span>), cap(<span style="color:#a6e22e">s4</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">f4</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s4</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;s4:%v len:%v cap:%v\n\n&#34;</span>, <span style="color:#a6e22e">s4</span>, len(<span style="color:#a6e22e">s4</span>), cap(<span style="color:#a6e22e">s4</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//s1:[1 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s1:[88 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s2:[1 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s2:[1 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s3:[1 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s3:[88 2 3 100] len:4 cap:6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s4:[1 2 3] len:3 cap:3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//s4:[88 2 3 100] len:4 cap:6
</span></span></span></code></pre></div><h4 id="切片增删">切片增删</h4>
<h5 id="添加元素">添加元素</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// 末尾添加元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sli</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>,<span style="color:#ae81ff">6</span>}<span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 开头添加元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sli</span> = append([]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">0</span>}, <span style="color:#a6e22e">sli</span><span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 中间添加元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">data</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 法一
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>[:<span style="color:#ae81ff">2</span>], append(<span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">...</span>)<span style="color:#f92672">...</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 法二
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, <span style="color:#a6e22e">data</span><span style="color:#f92672">...</span>)			<span style="color:#75715e">// 扩容
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>copy(<span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span><span style="color:#f92672">+</span>len(<span style="color:#a6e22e">data</span>):], <span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span>:])		<span style="color:#75715e">// 挪位置
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>copy(<span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">2</span>:], <span style="color:#a6e22e">data</span>)					<span style="color:#75715e">// 插入data
</span></span></span></code></pre></div><h5 id="删除元素">删除元素</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">a</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 删除末尾N个元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">a</span>[:len(<span style="color:#a6e22e">a</span>)<span style="color:#f92672">-</span><span style="color:#a6e22e">N</span>]	
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 删除开头N个元素
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">a</span>[<span style="color:#a6e22e">N</span>:]				
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 删除中间元素3、4、5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">a</span> = append(<span style="color:#a6e22e">a</span>[:<span style="color:#ae81ff">2</span>], <span style="color:#a6e22e">a</span>[<span style="color:#ae81ff">2</span><span style="color:#f92672">+</span><span style="color:#ae81ff">3</span>:]<span style="color:#f92672">...</span>)		
</span></span></code></pre></div><h4 id="切片类型强制转换">*切片类型强制转换</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;reflect&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sli</span> <span style="color:#f92672">:=</span> []<span style="color:#66d9ef">float64</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %T, %v, %v\n&#34;</span>, <span style="color:#a6e22e">sli</span>, <span style="color:#a6e22e">sli</span>, len(<span style="color:#a6e22e">sli</span>), cap(<span style="color:#a6e22e">sli</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s1</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s1</span> = ((<span style="color:#f92672">*</span>[<span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">20</span>]<span style="color:#66d9ef">int</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sli</span>[<span style="color:#ae81ff">0</span>])))[:len(<span style="color:#a6e22e">sli</span>):cap(<span style="color:#a6e22e">sli</span>)]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %T, %v, %v\n&#34;</span>, <span style="color:#a6e22e">s1</span>, <span style="color:#a6e22e">s1</span>, len(<span style="color:#a6e22e">s1</span>), cap(<span style="color:#a6e22e">s1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s2</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">sliAdr</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceHeader</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sli</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s2Adr</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">SliceHeader</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">s2Adr</span> = <span style="color:#f92672">*</span><span style="color:#a6e22e">sliAdr</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%v, %T, %v, %v\n&#34;</span>, <span style="color:#a6e22e">s2</span>, <span style="color:#a6e22e">s2</span>, len(<span style="color:#a6e22e">s2</span>), cap(<span style="color:#a6e22e">s2</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 《Go语言高级编程》p26
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//[1 2 3 4 5], []float64, 5, 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//[4607182418800017408 4611686018427387904 4613937818241073152 4616189618054758400 4617315517961601024], []int, 5, 5
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//[4607182418800017408 4611686018427387904 4613937818241073152 4616189618054758400 4617315517961601024], []int, 5, 5
</span></span></span></code></pre></div><h4 id="append扩容规则">append扩容规则</h4>
<p>当旧切片的容量小于256时，新切片的容量为其两倍，同时还需要内存对齐</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">//src/runtime/slice.go (2022.8.11最新版本go1.19)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">growslice</span>(<span style="color:#a6e22e">et</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>, <span style="color:#a6e22e">old</span> <span style="color:#a6e22e">slice</span>, <span style="color:#a6e22e">cap</span> <span style="color:#66d9ef">int</span>) <span style="color:#a6e22e">slice</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">newcap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">old</span>.<span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">doublecap</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">newcap</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">cap</span> &gt; <span style="color:#a6e22e">doublecap</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">threshold</span> = <span style="color:#ae81ff">256</span>
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">old</span>.<span style="color:#a6e22e">cap</span> &lt; <span style="color:#a6e22e">threshold</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">doublecap</span>
</span></span><span style="display:flex;"><span>		} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// Check 0 &lt; newcap to detect overflow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#75715e">// and prevent an infinite loop.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">for</span> <span style="color:#ae81ff">0</span> &lt; <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">newcap</span> &lt; <span style="color:#a6e22e">cap</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">// Transition from growing 2x for small slices
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>				<span style="color:#75715e">// to growing 1.25x for large slices. This formula
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>				<span style="color:#75715e">// gives a smooth-ish transition between the two.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>				<span style="color:#a6e22e">newcap</span> <span style="color:#f92672">+=</span> (<span style="color:#a6e22e">newcap</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span><span style="color:#a6e22e">threshold</span>) <span style="color:#f92672">/</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">// Set newcap to the requested cap when
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#75715e">// the newcap calculation overflowed.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>			<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">newcap</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">newcap</span> = <span style="color:#a6e22e">cap</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 对newcap进行内存对齐
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">sli</span> []<span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span><span style="color:#f92672">:=</span><span style="color:#ae81ff">1</span>;<span style="color:#a6e22e">i</span><span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">1024</span>;<span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">oldCap</span> <span style="color:#f92672">:=</span> cap(<span style="color:#a6e22e">sli</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">sli</span> = append(<span style="color:#a6e22e">sli</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">newCap</span> <span style="color:#f92672">:=</span> cap(<span style="color:#a6e22e">sli</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">newCap</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">oldCap</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">oldCap</span>, <span style="color:#a6e22e">newCap</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//0 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//1 2
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//2 4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//4 8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//8 16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//16 32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//32 64
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//64 128
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//128 256
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//256 512
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//512 848
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//848 1280
</span></span></span></code></pre></div><h4 id="make和new的区别">make和new的区别</h4>
<ol>
<li>适用类型不同：make只用于slice、map、channel；new不限制</li>
<li>返回值不同：make返回类型本身；new返回类型的指针</li>
<li>参数不同：make有多个参数；new只有一个参数</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// The make built-in function allocates and initializes an object of type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// slice, map, or chan (only). Like new, the first argument is a type, not a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// value. Unlike new, make&#39;s return type is the same as the type of its
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// argument, not a pointer to it. The specification of the result depends on
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// the type:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	Slice: The size specifies the length. The capacity of the slice is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	equal to its length. A second integer argument may be provided to
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	specify a different capacity; it must be no smaller than the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	length. For example, make([]int, 0, 10) allocates an underlying array
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	of size 10 and returns a slice of length 0 and capacity 10 that is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	backed by this underlying array.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	Map: An empty map is allocated with enough space to hold the
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	specified number of elements. The size may be omitted, in which case
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	a small starting size is allocated.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	Channel: The channel&#39;s buffer is initialized with the specified
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	buffer capacity. If zero, or the size is omitted, the channel is
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//	unbuffered.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> make(<span style="color:#a6e22e">t</span> <span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">size</span> <span style="color:#f92672">...</span><span style="color:#a6e22e">IntegerType</span>) <span style="color:#a6e22e">Type</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The new built-in function allocates memory. The first argument is a type,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// not a value, and the value returned is a pointer to a newly
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// allocated zero value of that type.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> new(<span style="color:#a6e22e">Type</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>
</span></span></code></pre></div>
</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "spf13" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
		</main>
		
		
		  
		
	</div>
	
  </body>
</html>
